<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>ODA ‚Äì Fracciones equivalentes, comparaci√≥n y orden (Din√°mica)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root{
      --primary:#1d4ed8;
      --primary-soft:#dbeafe;
      --accent:#0ea5e9;
      --text:#0f172a;
      --muted:#6b7280;
      --border:#e5e7eb;
      --card:#ffffff;
      --shadow:0 16px 35px rgba(15,23,42,.18);
      --error:#b91c1c;
      --success:#15803d;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family:system-ui,-apple-system,"Segoe UI",sans-serif;
      background:linear-gradient(180deg,#e0f2fe 0,#eff6ff 40%,#f9fafb 100%);
      color:var(--text);
      min-height:100vh;
      display:flex;
      justify-content:center;
      padding:14px 10px;
      position:relative;
    }
    body::before{
      content:"";
      position:fixed;
      inset:12% 16%;
      background:url("escudo_escuela.png") center/contain no-repeat;
      opacity:.03;
      pointer-events:none;
      z-index:0;
    }
    .school-logo-fixed{
      position:fixed;
      right:16px;
      bottom:10px;
      height:86px;
      opacity:0.95;
      z-index:5;
      pointer-events:none;
    }
    .wrapper{
      position:relative;
      z-index:1;
      width:100%;
      max-width:1180px;
      background:radial-gradient(circle at top left,#dbeafe 0,#ffffff 45%,#eff6ff 100%);
      border-radius:26px;
      box-shadow:var(--shadow);
      padding:14px 16px 16px;
      display:flex;
      flex-direction:column;
      gap:12px;
      border:1px solid #bfdbfe;
    }
    header{
      display:grid;
      grid-template-columns:auto minmax(0,2.3fr) auto;
      gap:10px;
      align-items:center;
      padding-bottom:8px;
      border-bottom:1px solid #dbeafe;
    }
    @media(max-width:900px){
      header{grid-template-columns:1fr;text-align:center;}
      .author-block{text-align:center;}
    }
    .logo-left img{
      max-height:60px;
      width:auto;
      display:block;
    }
    @media(max-width:900px){
      .logo-left{display:flex;justify-content:center;}
    }
    .title-block h1{
      margin:0;
      font-size:1.22rem;
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }
    .title-block h1 .icon{font-size:1.45rem;}
    .title-meta{
      margin-top:3px;
      font-size:.84rem;
      color:var(--muted);
    }
    .phase-label{
      display:inline-flex;
      align-items:center;
      gap:4px;
      padding:2px 8px;
      border-radius:999px;
      background:var(--primary-soft);
      color:var(--primary);
      margin-top:3px;
    }
    .chips{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:4px;
      font-size:.78rem;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:5px;
      padding:2px 8px;
      border-radius:999px;
      background:#eff6ff;
      border:1px solid #dbeafe;
    }
    .chip .dot{
      width:7px;height:7px;border-radius:999px;background:#22c55e;
    }
    .author-block{
      font-size:.82rem;
      color:var(--muted);
      text-align:right;
    }

    main{
      display:grid;
      grid-template-columns:minmax(0,1.7fr) minmax(0,1fr);
      gap:10px;
      margin-top:2px;
    }
    @media(max-width:900px){
      main{grid-template-columns:1fr;}
    }
    .left-column,.right-column{
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .card{
      background:var(--card);
      border-radius:18px;
      border:1px solid #e5e7eb;
      box-shadow:0 8px 20px rgba(15,23,42,.06);
      overflow:hidden;
    }
    .card-header{
      padding:8px 12px 6px;
      border-bottom:1px solid #e5e7eb;
      background:linear-gradient(90deg,#dbeafe,#eff6ff);
    }
    .card-title{
      display:flex;
      align-items:center;
      gap:6px;
      font-size:.9rem;
      font-weight:600;
      color:#0f172a;
    }
    .card-title .icon{font-size:1.05rem;}
    .card-body{
      padding:8px 12px 10px;
      font-size:.84rem;
    }

    .objective-list{
      padding-left:18px;
      margin:6px 0;
    }
    .objective-list li{margin-bottom:3px;}

    .timeline{
      margin-top:6px;
      border-radius:12px;
      border:1px dashed #bfdbfe;
      background:#eff6ff;
      padding:6px 8px;
      font-size:.8rem;
    }
    .timeline-item{
      display:flex;
      gap:6px;
      margin-bottom:3px;
    }
    .timeline-label{
      font-weight:600;
      color:var(--primary);
      min-width:97px;
    }

    .module-nav{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-bottom:8px;
    }
    .module-button{
      flex:1 1 120px;
      border-radius:999px;
      border:1px solid #bfdbfe;
      background:#eff6ff;
      padding:5px 8px;
      font-size:.78rem;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:5px;
      cursor:pointer;
      transition:.15s;
    }
    .module-button span.icon{font-size:.95rem;}
    .module-button.active{
      background:var(--primary);
      color:#fff;
      border-color:var(--primary);
      box-shadow:0 0 0 1px rgba(37,99,235,.6);
    }

    .module-panel{display:none;}
    .module-panel.active{display:block;}

    .status{
      margin-top:6px;
      border-radius:10px;
      padding:6px 8px;
      display:flex;
      gap:6px;
      font-size:.8rem;
      align-items:flex-start;
    }
    .status span{font-size:1rem;}
    .status-info{
      background:#eff6ff;
      border:1px solid #bfdbfe;
      color:#1e3a8a;
    }
    .status-success{
      background:#dcfce7;
      border:1px solid #22c55e;
      color:#166534;
    }
    .status-error{
      background:#fee2e2;
      border:1px solid #f97373;
      color:#991b1b;
    }

    .btn-row{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:6px;
    }
    .btn{
      border-radius:999px;
      border:none;
      padding:5px 10px;
      font-size:.8rem;
      display:inline-flex;
      align-items:center;
      gap:5px;
      cursor:pointer;
      white-space:nowrap;
    }
    .btn-primary{background:var(--primary);color:#fff;}
    .btn-secondary{background:#e5e7eb;color:#111827;}
    .btn-outline{
      background:#fff;
      border:1px solid #cbd5f5;
      color:#1e3a8a;
    }

    .options-list{
      list-style:none;
      padding-left:0;
      margin:6px 0;
      font-size:.8rem;
    }
    .options-list li{margin-bottom:4px;}
    .options-list label{
      display:flex;
      align-items:flex-start;
      gap:4px;
      cursor:pointer;
    }

    .frac-table, .compare-table{
      width:100%;
      border-collapse:collapse;
      margin-top:4px;
      font-size:.8rem;
    }
    .frac-table th, .frac-table td,
    .compare-table th, .compare-table td{
      border:1px solid #e5e7eb;
      padding:4px 6px;
      text-align:center;
    }
    .frac-table th, .compare-table th{
      background:#eff6ff;
      font-weight:600;
    }

    .frac-inputs{
      display:flex;
      gap:3px;
      justify-content:center;
      align-items:center;
    }
    .frac-inputs input{
      width:38px;
      padding:2px 3px;
      border-radius:8px;
      border:1px solid #cbd5f5;
      font-size:.78rem;
      text-align:center;
    }

    .compare-table select{
      width:70px;
      padding:3px 4px;
      border-radius:999px;
      border:1px solid #cbd5f5;
      font-size:.78rem;
    }

    .order-block{
      border-radius:10px;
      border:1px solid #e5e7eb;
      padding:6px 8px;
      margin-top:4px;
      background:#f9fafb;
      font-size:.8rem;
    }
    .order-block-title{
      font-weight:600;
      margin-bottom:2px;
      color:#1e3a8a;
    }
    .order-inputs{
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:4px;
      margin-top:4px;
    }
    .order-inputs label{
      font-size:.76rem;
      display:flex;
      flex-direction:column;
      gap:2px;
      align-items:flex-start;
    }
    .order-inputs input{
      width:100%;
      padding:3px 4px;
      border-radius:999px;
      border:1px solid #cbd5f5;
      font-size:.78rem;
    }

    .student-card .student-row{
      display:flex;
      flex-direction:column;
      gap:3px;
      margin-bottom:6px;
    }
    .student-card input[type="text"]{
      padding:5px 7px;
      border-radius:999px;
      border:1px solid #cbd5f5;
      font-size:.82rem;
      width:100%;
    }

    .avatar-card{
      display:flex;
      gap:10px;
      align-items:flex-start;
    }
    .avatar-circle{
      width:120px;
      height:auto;
      background:#eff6ff;
      border:1px solid #bfdbfe;
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius:18px;
      overflow:visible;
      flex-shrink:0;
    }
    .avatar-circle img{
      width:100%;
      height:auto;
      object-fit:contain;
      display:block;
    }
    .avatar-text{
      font-size:.8rem;
      color:#374151;
    }
    .avatar-steps{
      margin:4px 0;
      padding-left:18px;
    }
    .avatar-steps li{margin-bottom:3px;}
    .badge-step{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:16px;
      height:16px;
      border-radius:999px;
      background:#1d4ed8;
      color:#fff;
      font-size:.7rem;
      margin-right:4px;
    }

    footer{
      margin-top:4px;
      padding-top:7px;
      border-top:1px solid #dbeafe;
      font-size:.78rem;
      color:#6b7280;
      display:flex;
      justify-content:space-between;
      flex-wrap:wrap;
      gap:6px;
    }
    footer .project{
      font-style:italic;
      color:#4b5563;
    }
  </style>
</head>
<body>
  <img src="escudo_escuela.png" alt="Escudo escuela" class="school-logo-fixed">

  <div class="wrapper">
    <header>
      <div class="logo-left">
        <img src="sep_logo.png" alt="Secretar√≠a de Educaci√≥n P√∫blica">
      </div>
      <div class="title-block">
        <h1>
          <span class="icon">üßÆ</span>
          <span>Fracciones equivalentes, comparaci√≥n y orden ‚Äì Pensamiento Matem√°tico (Din√°mica)</span>
        </h1>
        <div class="title-meta">
          Contenido: <strong>Estudio de los n√∫meros.</strong><br>
          PDA 5.¬∫: <strong>Resuelve situaciones problem√°ticas que implican comparar y ordenar fracciones a partir de construir fracciones equivalentes al multiplicar o dividir al numerador y al denominador por un mismo n√∫mero.</strong><br>
          <span class="phase-label">Pensamiento Matem√°tico ¬∑ Fase 5 ¬∑ 5.¬∫ grado</span>
        </div>
        <div class="chips">
          <span class="chip"><span class="dot"></span>Campo formativo: Saberes y Pensamiento Matem√°tico</span>
          <span class="chip">Proyecto: <strong>N√∫meros que cuentan historias</strong></span>
        </div>
      </div>
      <div class="author-block">
        <strong>Autor: Mtro. Mart√≠n Reta</strong><br>
        Escuela Primaria ‚ÄúGral. L√°zaro C√°rdenas‚Äù<br>
        Ejido Santa Mar√≠a, Pesquer√≠a, N.L.
      </div>
    </header>

    <main>
      <!-- COLUMNA IZQUIERDA -->
      <section class="left-column">
        <!-- Prop√≥sito -->
        <div class="card">
          <div class="card-header">
            <div class="card-title">
              <span class="icon">üéØ</span>
              <span>Prop√≥sito de la ODA</span>
            </div>
          </div>
          <div class="card-body">
            Al finalizar esta ODA, las y los estudiantes ser√°n capaces de <strong>construir fracciones equivalentes</strong>,
            <strong>comparar</strong> y <strong>ordenar fracciones</strong>, explicando c√≥mo usar la equivalencia en situaciones de la vida diaria
            (repartos, recetas, juegos, etc.).
            <ul class="objective-list">
              <li>Reconocer fracciones equivalentes a partir de dibujos o n√∫meros.</li>
              <li>Construir fracciones equivalentes multiplicando el numerador y el denominador por el mismo n√∫mero.</li>
              <li>Comparar fracciones usando fracciones equivalentes o el valor que representan.</li>
              <li>Ordenar fracciones de menor a mayor y de mayor a menor.</li>
            </ul>
            <div class="timeline">
              <div class="timeline-item">
                <div class="timeline-label">1. Exploro</div>
                <div>Identifico cu√°les fracciones representan lo mismo.</div>
              </div>
              <div class="timeline-item">
                <div class="timeline-label">2. Construyo</div>
                <div>Creo fracciones equivalentes multiplicando.</div>
              </div>
              <div class="timeline-item">
                <div class="timeline-label">3. Comparo</div>
                <div>Decido cu√°l fracci√≥n es mayor, menor o si son iguales.</div>
              </div>
              <div class="timeline-item">
                <div class="timeline-label">4. Ordeno</div>
                <div>Acomodo fracciones y reviso mi comprensi√≥n.</div>
              </div>
            </div>
          </div>
        </div>

        <!-- M√≥dulos -->
        <div class="card">
          <div class="card-header">
            <div class="card-title">
              <span class="icon">üß©</span>
              <span>M√≥dulos de trabajo</span>
            </div>
          </div>
          <div class="card-body">
            <div class="module-nav">
              <button class="module-button active" data-module="explora">
                <span class="icon">üëÄ</span> Explora equivalencias
              </button>
              <button class="module-button" data-module="equiv">
                <span class="icon">‚úèÔ∏è</span> Construye equivalentes
              </button>
              <button class="module-button" data-module="compara">
                <span class="icon">‚öñÔ∏è</span> Compara fracciones
              </button>
              <button class="module-button" data-module="ordena">
                <span class="icon">üìä</span> Ordena y eval√∫ate
              </button>
            </div>

            <!-- Panel 1: Explora -->
            <div id="panel-explora" class="module-panel active">
              <p>Elige en cada caso qu√© fracci√≥n es <strong>equivalente</strong> a la que est√° subrayada.</p>
              <ol class="options-list">
                <li>
                  <div><strong>1)</strong> La fracci√≥n subrayada es <u>1/2</u>. ¬øCu√°l fracci√≥n representa lo mismo?</div>
                  <ul class="options-list">
                    <li><label><input type="radio" name="ex1" value="a"> 2/4</label></li>
                    <li><label><input type="radio" name="ex1" value="b"> 1/4</label></li>
                    <li><label><input type="radio" name="ex1" value="c"> 3/5</label></li>
                  </ul>
                </li>
                <li>
                  <div><strong>2)</strong> La fracci√≥n subrayada es <u>3/5</u>. ¬øCu√°l de las siguientes es equivalente?</div>
                  <ul class="options-list">
                    <li><label><input type="radio" name="ex2" value="a"> 6/10</label></li>
                    <li><label><input type="radio" name="ex2" value="b"> 3/10</label></li>
                    <li><label><input type="radio" name="ex2" value="c"> 5/3</label></li>
                  </ul>
                </li>
                <li>
                  <div><strong>3)</strong> La fracci√≥n subrayada es <u>2/3</u>. ¬øCu√°l fracci√≥n es equivalente?</div>
                  <ul class="options-list">
                    <li><label><input type="radio" name="ex3" value="a"> 4/9</label></li>
                    <li><label><input type="radio" name="ex3" value="b"> 4/6</label></li>
                    <li><label><input type="radio" name="ex3" value="c"> 6/9</label></li>
                  </ul>
                </li>
              </ol>
              <div class="btn-row">
                <button class="btn btn-primary" id="btnCheckExplora">üìù Revisar respuestas</button>
                <button class="btn btn-secondary" id="btnResetExplora">‚Ü©Ô∏è Empezar de nuevo</button>
              </div>
              <div id="statusExplora" class="status status-info">
                <span>‚ÑπÔ∏è</span>
                <div>Elige una respuesta en cada pregunta y haz clic en <strong>‚ÄúRevisar respuestas‚Äù</strong>.</div>
              </div>
            </div>

            <!-- Panel 2: Construye equivalentes -->
            <div id="panel-equiv" class="module-panel">
              <p>
                Completa la tabla. Para cada fracci√≥n base multiplica el <strong>numerador</strong> y el <strong>denominador</strong>
                por el n√∫mero indicado para obtener una fracci√≥n equivalente.
              </p>
              <table class="frac-table" id="tableEquiv">
                <thead>
                  <tr>
                    <th>Fracci√≥n base</th>
                    <th>Multiplica por</th>
                    <th>Fracci√≥n equivalente</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- se llena con JS -->
                </tbody>
              </table>
              <div class="btn-row">
                <button class="btn btn-secondary" id="btnGenEquiv">üîÑ Nuevas fracciones</button>
                <button class="btn btn-primary" id="btnCheckEquiv">‚úÖ Revisar</button>
                <button class="btn btn-secondary" id="btnResetEquiv">‚Ü©Ô∏è Limpiar</button>
              </div>
              <div id="statusEquiv" class="status status-info">
                <span>‚ÑπÔ∏è</span>
                <div>Escribe la fracci√≥n equivalente y haz clic en <strong>‚ÄúRevisar‚Äù</strong>.</div>
              </div>
            </div>

            <!-- Panel 3: Compara -->
            <div id="panel-compara" class="module-panel">
              <p>Completa con el signo correcto <strong>&gt;</strong>, <strong>&lt;</strong> o <strong>=</strong> seg√∫n cu√°l fracci√≥n es mayor.</p>
              <table class="compare-table" id="tableCompare">
                <thead>
                  <tr>
                    <th>Fracci√≥n A</th>
                    <th>Signo</th>
                    <th>Fracci√≥n B</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- se llena con JS -->
                </tbody>
              </table>
              <div class="btn-row">
                <button class="btn btn-secondary" id="btnGenCompare">üîÑ Nuevas parejas</button>
                <button class="btn btn-primary" id="btnCheckCompare">‚úÖ Revisar</button>
                <button class="btn btn-secondary" id="btnResetCompare">‚Ü©Ô∏è Limpiar</button>
              </div>
              <div id="statusCompare" class="status status-info">
                <span>‚ÑπÔ∏è</span>
                <div>Elige un signo en cada fila y luego haz clic en <strong>‚ÄúRevisar‚Äù</strong>.</div>
              </div>
            </div>

            <!-- Panel 4: Ordena -->
            <div id="panel-ordena" class="module-panel">
              <p>Observa las listas y escribe las fracciones <strong>de menor a mayor</strong>.</p>
              <div id="orderContainer"><!-- se llena con JS --></div>
              <div class="btn-row">
                <button class="btn btn-secondary" id="btnGenOrder">üîÑ Nuevas listas</button>
                <button class="btn btn-primary" id="btnCheckOrder">‚úÖ Revisar</button>
                <button class="btn btn-secondary" id="btnResetOrder">‚Ü©Ô∏è Limpiar</button>
              </div>
              <div id="statusOrder" class="status status-info">
                <span>‚ÑπÔ∏è</span>
                <div>Escribe las fracciones de menor a mayor y haz clic en <strong>‚ÄúRevisar‚Äù</strong>.</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- COLUMNA DERECHA -->
      <section class="right-column">
        <!-- Datos del alumno -->
        <div class="card student-card">
          <div class="card-header">
            <div class="card-title">
              <span class="icon">üßë‚Äçüéì</span>
              <span>Datos del alumno y controles</span>
            </div>
          </div>
          <div class="card-body">
            <div class="student-row">
              <label for="studentName">Nombre del alumno(a):</label>
              <input type="text" id="studentName" placeholder="Escribe tu nombre aqu√≠">
            </div>
            <div class="btn-row">
              <button class="btn btn-outline" id="btnPrintResults">üñ®Ô∏è Imprimir resultados</button>
              <button class="btn btn-outline" id="btnPrintActivity">üìÑ Actividad para imprimir</button>
            </div>
          </div>
        </div>

        <!-- Avatar gu√≠a -->
        <div class="card">
          <div class="card-header">
            <div class="card-title">
              <span class="icon">üßë‚Äçüè´</span>
              <span>Avatar gu√≠a ‚Äì Instrucciones</span>
            </div>
          </div>
          <div class="card-body avatar-card">
            <div class="avatar-circle" aria-hidden="true">
              <img src="avatar_guia.png" alt="Avatar del Mtro. Mart√≠n Reta">
            </div>
            <div class="avatar-text">
              <strong>Hola, soy el maestro Mart√≠n Reta.</strong> Hoy practicaremos fracciones equivalentes y c√≥mo nos ayudan a comparar y ordenar.
              <ol class="avatar-steps">
                <li><span class="badge-step">1</span> En <strong>‚ÄúExplora equivalencias‚Äù</strong> identificas fracciones que representan lo mismo.</li>
                <li><span class="badge-step">2</span> En <strong>‚ÄúConstruye equivalentes‚Äù</strong> completas fracciones multiplicando numerador y denominador.</li>
                <li><span class="badge-step">3</span> En <strong>‚ÄúCompara fracciones‚Äù</strong> decides cu√°l fracci√≥n es mayor o menor.</li>
                <li><span class="badge-step">4</span> En <strong>‚ÄúOrdena y eval√∫ate‚Äù</strong> ordenas fracciones de menor a mayor.</li>
              </ol>
              <button class="btn btn-primary" id="btnPlayVoice">üîä Escucha las instrucciones</button>
            </div>
          </div>
        </div>

        <!-- Sugerencias -->
        <div class="card">
          <div class="card-header">
            <div class="card-title">
              <span class="icon">üìå</span>
              <span>Sugerencias de uso en el aula</span>
            </div>
          </div>
          <div class="card-body">
            <ul class="objective-list">
              <li>Relaciona las fracciones con <strong>repartos de comida, recipientes con agua, trozos de papel</strong>, etc.</li>
              <li>Pide a las y los estudiantes que <strong>dibujen</strong> las fracciones que est√°n comparando.</li>
              <li>Invita a inventar problemas de la vida diaria usando fracciones equivalentes.</li>
            </ul>
          </div>
        </div>
      </section>
    </main>

    <footer>
      <div>¬© 2025. Elaborado por <strong>Mtro. Mart√≠n Reta</strong> ‚Äì Escuela Primaria ‚ÄúGral. L√°zaro C√°rdenas‚Äù.</div>
      <div class="project">Proyecto ‚ÄúN√∫meros que cuentan historias‚Äù ¬∑ ODA: Fracciones equivalentes (PDA 4).</div>
    </footer>
  </div>

  <script>
    function randInt(min,max){return Math.floor(Math.random()*(max-min+1))+min;}

    // Navegaci√≥n
    const moduleButtons=document.querySelectorAll(".module-button");
    const panels={
      explora:document.getElementById("panel-explora"),
      equiv:document.getElementById("panel-equiv"),
      compara:document.getElementById("panel-compara"),
      ordena:document.getElementById("panel-ordena")
    };
    moduleButtons.forEach(btn=>{
      btn.addEventListener("click",()=>{
        const mod=btn.dataset.module;
        moduleButtons.forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
        Object.keys(panels).forEach(k=>panels[k].classList.remove("active"));
        panels[mod].classList.add("active");
      });
    });

    let lastExploraScore=null,lastEquivScore=null,lastCompareScore=null,lastOrderScore=null;

    // Explora
    const statusExplora=document.getElementById("statusExplora");
    document.getElementById("btnCheckExplora").addEventListener("click",()=>{
      const answers={ex1:"a",ex2:"a",ex3:"c"};
      let total=3,correct=0,unanswered=0,msg=[];
      ["ex1","ex2","ex3"].forEach((q,i)=>{
        const sel=document.querySelector('input[name="'+q+'"]:checked');
        if(!sel){unanswered++;return;}
        if(sel.value===answers[q]){
          correct++;msg.push("Pregunta "+(i+1)+": ‚úÖ correcta.");
        }else{
          msg.push("Pregunta "+(i+1)+": revisa qu√© fracci√≥n representa la misma parte del entero.");
        }
      });
      if(unanswered>0){
        statusExplora.className="status status-info";
        statusExplora.innerHTML="<span>‚ÑπÔ∏è</span><div>Te faltan <strong>"+unanswered+"</strong> pregunta(s) por responder.</div>";
        return;
      }
      const percent=Math.round(correct/total*100);
      lastExploraScore={correct,total,percent};
      if(correct>=2){
        statusExplora.className="status status-success";
        statusExplora.innerHTML="<span>‚úÖ</span><div>Acertaste <strong>"+correct+" de "+total+"</strong> ("+percent+"%).<br>"+msg.join("<br>")+"</div>";
      }else{
        statusExplora.className="status status-error";
        statusExplora.innerHTML="<span>üìò</span><div>Acertaste <strong>"+correct+" de "+total+"</strong> ("+percent+"%). Puedes volver a revisar qu√© significa que dos fracciones sean equivalentes.<br>"+msg.join("<br>")+"</div>";
      }
    });
    document.getElementById("btnResetExplora").addEventListener("click",()=>{
      ["ex1","ex2","ex3"].forEach(name=>{
        document.querySelectorAll('input[name="'+name+'"]').forEach(r=>r.checked=false);
      });
      lastExploraScore=null;
      statusExplora.className="status status-info";
      statusExplora.innerHTML="<span>‚ÑπÔ∏è</span><div>Elige una respuesta en cada pregunta y haz clic en <strong>‚ÄúRevisar respuestas‚Äù</strong>.</div>";
    });

    // Construye equivalentes
    const tableEquivBody=document.querySelector("#tableEquiv tbody");
    const statusEquiv=document.getElementById("statusEquiv");
    let equivData=[];
    function genEquivRows(){
      equivData=[];
      tableEquivBody.innerHTML="";
      const bases=[
        {n:1,d:2},
        {n:2,d:3},
        {n:3,d:4},
        {n:3,d:5},
        {n:4,d:5},
        {n:5,d:6}
      ];
      for(let i=0;i<3;i++){
        const base=bases[randInt(0,bases.length-1)];
        const k=randInt(2,5);
        const tr=document.createElement("tr");
        const tdBase=document.createElement("td");
        const tdK=document.createElement("td");
        const tdEq=document.createElement("td");
        tdBase.textContent=base.n+"/"+base.d;
        tdK.textContent="√ó "+k;
        const wrap=document.createElement("div");
        wrap.className="frac-inputs";
        const inNum=document.createElement("input");
        inNum.type="number";
        inNum.setAttribute("data-row",i);
        inNum.setAttribute("data-part","num");
        const slash=document.createElement("span");
        slash.textContent="/";
        const inDen=document.createElement("input");
        inDen.type="number";
        inDen.setAttribute("data-row",i);
        inDen.setAttribute("data-part","den");
        wrap.appendChild(inNum);
        wrap.appendChild(slash);
        wrap.appendChild(inDen);
        tdEq.appendChild(wrap);
        tr.appendChild(tdBase);
        tr.appendChild(tdK);
        tr.appendChild(tdEq);
        tableEquivBody.appendChild(tr);
        equivData.push({base:k===0?base:{n:base.n,d:base.d},k});
      }
    }
    genEquivRows();

    document.getElementById("btnGenEquiv").addEventListener("click",()=>{
      genEquivRows();
      lastEquivScore=null;
      statusEquiv.className="status status-info";
      statusEquiv.innerHTML="<span>‚ÑπÔ∏è</span><div>Se generaron nuevas fracciones. Compl√©talas y haz clic en <strong>‚ÄúRevisar‚Äù</strong>.</div>";
    });

    document.getElementById("btnCheckEquiv").addEventListener("click",()=>{
      const inputs=tableEquivBody.querySelectorAll("input");
      let total=equivData.length,correct=0,empty=0;
      for(let i=0;i<equivData.length;i++){
        const base=equivData[i].base;
        const k=equivData[i].k;
        const expectedNum=base.n*k;
        const expectedDen=base.d*k;
        const numInput=tableEquivBody.querySelector('input[data-row="'+i+'"][data-part="num"]');
        const denInput=tableEquivBody.querySelector('input[data-row="'+i+'"][data-part="den"]');
        const vNum=numInput.value.trim();
        const vDen=denInput.value.trim();
        if(vNum==="" || vDen===""){empty++;continue;}
        if(parseInt(vNum,10)===expectedNum && parseInt(vDen,10)===expectedDen){
          correct++;
        }
      }
      if(empty>0){
        statusEquiv.className="status status-info";
        statusEquiv.innerHTML="<span>‚ÑπÔ∏è</span><div>Te faltan <strong>"+empty+"</strong> fracci√≥n(es) por completar.</div>";
        return;
      }
      const percent=Math.round(correct/total*100);
      lastEquivScore={correct,total,percent};
      if(percent>=70){
        statusEquiv.className="status status-success";
        statusEquiv.innerHTML="<span>‚úÖ</span><div>Construiste correctamente <strong>"+correct+" de "+total+"</strong> fracciones equivalentes ("+percent+"%). Excelente uso de la regla de multiplicar numerador y denominador por el mismo n√∫mero.</div>";
      }else{
        statusEquiv.className="status status-error";
        statusEquiv.innerHTML="<span>üìò</span><div>Construiste correctamente <strong>"+correct+" de "+total+"</strong> fracciones equivalentes ("+percent+"%). Revisa de nuevo que multipliques por el mismo n√∫mero arriba y abajo.</div>";
      }
    });
    document.getElementById("btnResetEquiv").addEventListener("click",()=>{
      tableEquivBody.querySelectorAll("input").forEach(i=>i.value="");
      lastEquivScore=null;
      statusEquiv.className="status status-info";
      statusEquiv.innerHTML="<span>‚ÑπÔ∏è</span><div>Escribe la fracci√≥n equivalente y haz clic en <strong>‚ÄúRevisar‚Äù</strong>.</div>";
    });

    // Compara
    const tableCompareBody=document.querySelector("#tableCompare tbody");
    const statusCompare=document.getElementById("statusCompare");
    let compareData=[];
    function genFraction(){
      const d=[2,3,4,5,6,8,10,12][randInt(0,7)];
      const n=randInt(1,d-1);
      return {n,d};
    }
    function fractionToString(f){return f.n+"/"+f.d;}
    function fractionValue(f){return f.n/f.d;}

    function genCompareRows(){
      compareData=[];
      tableCompareBody.innerHTML="";
      for(let i=0;i<4;i++){
        let a=genFraction(),b=genFraction();
        const tr=document.createElement("tr");
        const tdA=document.createElement("td");
        const tdS=document.createElement("td");
        const tdB=document.createElement("td");
        tdA.textContent=fractionToString(a);
        tdB.textContent=fractionToString(b);
        const sel=document.createElement("select");
        sel.innerHTML='<option value="">--</option><option value=">">&gt;</option><option value="<">&lt;</option><option value="=">=</option>';
        sel.setAttribute("data-idx",i);
        tdS.appendChild(sel);
        tr.appendChild(tdA);tr.appendChild(tdS);tr.appendChild(tdB);
        tableCompareBody.appendChild(tr);
        let vA=fractionValue(a),vB=fractionValue(b);
        let sign="=";
        if(vA>vB)sign=">";
        else if(vA<vB)sign="<";
        compareData.push({a,b,sign});
      }
    }
    genCompareRows();

    document.getElementById("btnGenCompare").addEventListener("click",()=>{
      genCompareRows();
      lastCompareScore=null;
      statusCompare.className="status status-info";
      statusCompare.innerHTML="<span>‚ÑπÔ∏è</span><div>Se generaron nuevas parejas de fracciones. Compl√©talas y haz clic en <strong>‚ÄúRevisar‚Äù</strong>.</div>";
    });

    document.getElementById("btnCheckCompare").addEventListener("click",()=>{
      const selects=tableCompareBody.querySelectorAll("select");
      let total=compareData.length,correct=0,empty=0;
      selects.forEach(sel=>{
        const idx=parseInt(sel.getAttribute("data-idx"),10);
        const val=sel.value;
        if(!val){empty++;return;}
        if(val===compareData[idx].sign)correct++;
      });
      if(empty>0){
        statusCompare.className="status status-info";
        statusCompare.innerHTML="<span>‚ÑπÔ∏è</span><div>Te faltan <strong>"+empty+"</strong> comparaci√≥n(es) por completar.</div>";
        return;
      }
      const percent=Math.round(correct/total*100);
      lastCompareScore={correct,total,percent};
      if(percent>=70){
        statusCompare.className="status status-success";
        statusCompare.innerHTML="<span>‚úÖ</span><div>Respondiste correctamente <strong>"+correct+" de "+total+"</strong> comparaciones ("+percent+"%). Muy bien comparando fracciones.</div>";
      }else{
        statusCompare.className="status status-error";
        statusCompare.innerHTML="<span>üìò</span><div>Respondiste correctamente <strong>"+correct+" de "+total+"</strong> comparaciones ("+percent+"%). Vuelve a comparar usando fracciones equivalentes o dibujos.</div>";
      }
    });

    document.getElementById("btnResetCompare").addEventListener("click",()=>{
      tableCompareBody.querySelectorAll("select").forEach(s=>s.value="");
      lastCompareScore=null;
      statusCompare.className="status status-info";
      statusCompare.innerHTML="<span>‚ÑπÔ∏è</span><div>Elige un signo en cada fila y luego haz clic en <strong>‚ÄúRevisar‚Äù</strong>.</div>";
    });

    // Ordena
    const orderContainer=document.getElementById("orderContainer");
    const statusOrder=document.getElementById("statusOrder");
    let orderData=[];
    function genOrderBlocks(){
      orderData=[];
      orderContainer.innerHTML="";
      for(let i=0;i<3;i++){
        const list=[];
        while(list.length<4){
          const f=genFraction();
          if(!list.some(g=>g.n===f.n && g.d===f.d)) list.push(f);
        }
        const sorted=[...list].sort((a,b)=>fractionValue(a)-fractionValue(b));
        orderData.push({original:list,sorted});
        const block=document.createElement("div");
        block.className="order-block";
        block.setAttribute("data-idx",i);
        block.innerHTML="<div class='order-block-title'>Lista "+(i+1)+"</div>"+
          "<div>Fracciones: <strong>"+list.map(fractionToString).join(", ")+"</strong></div>";
        const inputs=document.createElement("div");
        inputs.className="order-inputs";
        for(let k=0;k<4;k++){
          const label=document.createElement("label");
          label.innerHTML="<span>"+(k+1)+"¬∫ lugar:</span>";
          const inp=document.createElement("input");
          inp.type="text";
          inp.setAttribute("data-pos",k);
          inp.placeholder="ej. 1/2";
          label.appendChild(inp);
          inputs.appendChild(label);
        }
        block.appendChild(inputs);
        orderContainer.appendChild(block);
      }
    }
    genOrderBlocks();

    function parseFraction(str){
      const clean=str.replace(/\s/g,"");
      const parts=clean.split("/");
      if(parts.length!==2)return null;
      const n=parseInt(parts[0],10),d=parseInt(parts[1],10);
      if(isNaN(n)||isNaN(d)||d===0)return null;
      return {n,d};
    }

    document.getElementById("btnGenOrder").addEventListener("click",()=>{
      genOrderBlocks();
      lastOrderScore=null;
      statusOrder.className="status status-info";
      statusOrder.innerHTML="<span>‚ÑπÔ∏è</span><div>Se generaron nuevas listas. Escr√≠belas de menor a mayor.</div>";
    });

    document.getElementById("btnCheckOrder").addEventListener("click",()=>{
      const blocks=orderContainer.querySelectorAll(".order-block");
      let total=0,correct=0,empty=0;
      blocks.forEach(block=>{
        const idx=parseInt(block.getAttribute("data-idx"),10);
        const sorted=orderData[idx].sorted;
        const inputs=block.querySelectorAll("input");
        inputs.forEach((inp,pos)=>{
          total++;
          const val=inp.value.trim();
          if(val===""){empty++;return;}
          const f=parseFraction(val);
          if(!f)return;
          const target=sorted[pos];
          if(Math.abs(fractionValue(f)-fractionValue(target))<1e-6)correct++;
        });
      });
      if(empty>0){
        statusOrder.className="status status-info";
        statusOrder.innerHTML="<span>‚ÑπÔ∏è</span><div>Te faltan <strong>"+empty+"</strong> espacio(s) por completar.</div>";
        return;
      }
      const percent=Math.round(correct/total*100);
      lastOrderScore={correct,total,percent};
      if(percent>=70){
        statusOrder.className="status status-success";
        statusOrder.innerHTML="<span>‚úÖ</span><div>Ordenaste correctamente <strong>"+correct+" de "+total+"</strong> posiciones ("+percent+"%). Muy buen manejo del orden de fracciones.</div>";
      }else{
        statusOrder.className="status status-error";
        statusOrder.innerHTML="<span>üìò</span><div>Ordenaste correctamente <strong>"+correct+" de "+total+"</strong> posiciones ("+percent+"%). Puedes volver a generar listas y practicar m√°s.</div>";
      }
    });

    document.getElementById("btnResetOrder").addEventListener("click",()=>{
      orderContainer.querySelectorAll("input").forEach(i=>i.value="");
      lastOrderScore=null;
      statusOrder.className="status status-info";
      statusOrder.innerHTML="<span>‚ÑπÔ∏è</span><div>Escribe las fracciones de menor a mayor y haz clic en <strong>‚ÄúRevisar‚Äù</strong>.</div>";
    });

    // Voz
    const btnPlayVoice=document.getElementById("btnPlayVoice");
    const instructionsText="Hola, soy el maestro Martin Reta. En esta actividad vas a trabajar con fracciones equivalentes. Primero identifica cuales fracciones representan lo mismo. Luego construye fracciones equivalentes multiplicando el numerador y el denominador por el mismo numero. Despues compara fracciones y decide cual es mayor o menor. Al final ordena fracciones de menor a mayor para comprobar que entendiste.";
    function speakInstructions(){
      if(!('speechSynthesis' in window)){
        alert("Tu navegador no permite la lectura en voz alta. Puedes leer las instrucciones en pantalla.");
        return;
      }
      window.speechSynthesis.cancel();
      const u=new SpeechSynthesisUtterance(instructionsText);
      u.lang="es-MX";
      const voices=window.speechSynthesis.getVoices();
      let chosen=null;
      if(voices && voices.length){
        chosen=voices.find(v=>v.lang.startsWith("es") && /Hombre|Male|Miguel|Diego|Jorge|Antonio|Carlos/i.test(v.name))
               || voices.find(v=>v.lang.startsWith("es"))
               || voices[0];
      }
      if(chosen)u.voice=chosen;
      window.speechSynthesis.speak(u);
    }
    btnPlayVoice.addEventListener("click",()=>{
      const voices=window.speechSynthesis.getVoices();
      if(!voices || !voices.length){
        window.speechSynthesis.onvoiceschanged=speakInstructions;
        window.speechSynthesis.getVoices();
      }else{
        speakInstructions();
      }
    });

    // Imprimir resultados
    document.getElementById("btnPrintResults").addEventListener("click",()=>{
      const studentName=document.getElementById("studentName").value.trim();
      if(!lastExploraScore && !lastEquivScore && !lastCompareScore && !lastOrderScore){
        alert("Primero realiza al menos un m√≥dulo para poder imprimir resultados.");
        return;
      }
      const w=window.open("","_blank");
      w.document.write("<html><head><title>Resultados del estudiante ‚Äì Fracciones equivalentes</title>");
      w.document.write('<style>body{font-family:system-ui,Arial,sans-serif;font-size:13px;padding:16px;color:#111827;} h1{font-size:20px;margin-bottom:4px;} h2{font-size:16px;margin-top:16px;margin-bottom:6px;} p{margin:4px 0;} .small{font-size:12px;color:#4b5563;} .blue{color:#1d4ed8;}</style>');
      w.document.write("</head><body>");
      w.document.write("<h1>Resultados del estudiante ‚Äì Fracciones equivalentes (PDA 4)</h1>");
      w.document.write("<p><strong>Nombre del alumno(a):</strong> "+(studentName||"______________________________")+"</p>");
      w.document.write("<p><strong>Docente:</strong> Mtro. Mart√≠n Reta</p>");
      w.document.write("<p><strong>Proyecto:</strong> N√∫meros que cuentan historias</p>");
      w.document.write("<p class='small'><strong>PDA:</strong> Resuelve situaciones problem√°ticas que implican comparar y ordenar fracciones a partir de construir fracciones equivalentes al multiplicar o dividir al numerador y al denominador por un mismo n√∫mero.</p>");

      if(lastExploraScore){
        w.document.write("<h2>M√≥dulo 1. Explora equivalencias</h2>");
        w.document.write("<p>Puntaje: <span class='blue'>"+lastExploraScore.correct+" de "+lastExploraScore.total+" ("+lastExploraScore.percent+"%)</span></p>");
      }
      if(lastEquivScore){
        w.document.write("<h2>M√≥dulo 2. Construye equivalentes</h2>");
        w.document.write("<p>Puntaje: <span class='blue'>"+lastEquivScore.correct+" de "+lastEquivScore.total+" ("+lastEquivScore.percent+"%)</span></p>");
      }
      if(lastCompareScore){
        w.document.write("<h2>M√≥dulo 3. Compara fracciones</h2>");
        w.document.write("<p>Puntaje: <span class='blue'>"+lastCompareScore.correct+" de "+lastCompareScore.total+" ("+lastCompareScore.percent+"%)</span></p>");
      }
      if(lastOrderScore){
        w.document.write("<h2>M√≥dulo 4. Ordena fracciones</h2>");
        w.document.write("<p>Puntaje: <span class='blue'>"+lastOrderScore.correct+" de "+lastOrderScore.total+" ("+lastOrderScore.percent+"%)</span></p>");
      }

      w.document.write("<p class='small'><strong>Observaciones del docente:</strong></p>");
      w.document.write("<p class='small'>______________________________________________</p>");
      w.document.write("<p class='small'>______________________________________________</p>");
      w.document.write("<p class='small'>______________________________________________</p>");
      w.document.write("</body></html>");
      w.document.close();
      w.print();
    });

    // Actividad imprimible
    document.getElementById("btnPrintActivity").addEventListener("click",()=>{
      const studentName=document.getElementById("studentName").value.trim();
      const w=window.open("","_blank");
      w.document.write("<html><head><title>Actividad para imprimir ‚Äì Fracciones equivalentes</title>");
      w.document.write('<style>body{font-family:system-ui,Arial,sans-serif;font-size:13px;padding:16px;color:#111827;} h1{font-size:20px;margin-bottom:4px;} h2{font-size:16px;margin-top:16px;margin-bottom:6px;} p{margin:6px 0;} ol{padding-left:18px;} li{margin-bottom:6px;} .small{font-size:12px;color:#4b5563;} table{border-collapse:collapse;width:100%;margin-top:6px;} th,td{border:1px solid #e5e7eb;padding:4px 6px;text-align:center;font-size:12px;} th{background:#eff6ff;} .left{text-align:left;font-weight:600;}</style>');
      w.document.write("</head><body>");
      w.document.write("<h1>Actividad para imprimir ‚Äì Fracciones equivalentes</h1>");
      w.document.write("<p><strong>Nombre del alumno(a):</strong> "+(studentName||"______________________________")+"</p>");
      w.document.write("<p><strong>Docente:</strong> Mtro. Mart√≠n Reta &nbsp;&nbsp;&nbsp; <strong>Proyecto:</strong> N√∫meros que cuentan historias</p>");
      w.document.write("<p class='small'><strong>PDA:</strong> Resuelve situaciones problem√°ticas que implican comparar y ordenar fracciones a partir de construir fracciones equivalentes al multiplicar o dividir al numerador y al denominador por un mismo n√∫mero.</p>");

      w.document.write("<h2>Parte A. Marca las fracciones equivalentes</h2>");
      w.document.write("<p>Colorea las parejas de fracciones que sean equivalentes.</p>");
      w.document.write("<table><tr><th>Pareja</th><th>Fracci√≥n 1</th><th>Fracci√≥n 2</th></tr>");
      const pairs=[["1/2","2/4"],["2/3","4/6"],["3/5","6/10"],["2/4","3/8"],["1/3","2/6"]];
      pairs.forEach((p,i)=>{
        w.document.write("<tr><td class='left'>"+(i+1)+"</td><td>"+p[0]+"</td><td>"+p[1]+"</td></tr>");
      });
      w.document.write("</table>");

      w.document.write("<h2>Parte B. Completa fracciones equivalentes</h2>");
      w.document.write("<p>Completa las fracciones equivalentes multiplicando o dividiendo numerador y denominador por el mismo n√∫mero.</p>");
      w.document.write("<ol>");
      w.document.write("<li>1/2 = ____/4 = ____/8</li>");
      w.document.write("<li>3/4 = ____/8 = ____/16</li>");
      w.document.write("<li>2/3 = ____/6 = ____/9</li>");
      w.document.write("</ol>");

      w.document.write("<h2>Parte C. Ordena fracciones</h2>");
      w.document.write("<p>Ordena de menor a mayor.</p>");
      w.document.write("<ol>");
      w.document.write("<li>1/2, 3/4, 1/4, 2/4</li>");
      w.document.write("<li>2/3, 1/3, 3/3, 4/3</li>");
      w.document.write("<li>1/5, 3/5, 2/5, 4/5</li>");
      w.document.write("</ol>");

      w.document.write("<h2>Parte D. Problema</h2>");
      w.document.write("<p>Resuelve y explica.</p>");
      w.document.write("<p>En una fiesta, se reparten dos pasteles iguales. En el primer pastel se reparten 3/6 y en el segundo pastel se reparten 1/2.</p>");
      w.document.write("<ol>");
      w.document.write("<li>¬øSon equivalentes las partes repartidas? ¬øPor qu√©?</li>");
      w.document.write("<li>Representa con un dibujo las fracciones 3/6 y 1/2.</li>");
      w.document.write("</ol>");

      w.document.write("</body></html>");
      w.document.close();
      w.print();
    });
  </script>
</body>
</html>
