<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>ODA ‚Äì Sopa de letras del Sistema Solar (Saberes y Pensamiento Cient√≠fico)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root{
      --bg-dark:#020617;
      --primary:#0f172a;
      --accent:#4f46e5;
      --accent-2:#0ea5e9;
      --card:#ffffff;
      --border:#e2e8f0;
      --muted:#64748b;
      --success:#16a34a;
      --danger:#b91c1c;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family:system-ui,-apple-system,"Segoe UI",sans-serif;
      background:radial-gradient(circle at top,#0f172a 0,var(--bg-dark) 40%,var(--bg-dark) 100%);
      min-height:100vh;
      display:flex;
      justify-content:center;
      padding:14px 10px;
      position:relative;
      color:#0b1120;
    }
    body::before{
      content:"";
      position:fixed;
      inset:12% 18%;
      background:url("escudo_escuela.png") center/contain no-repeat;
      opacity:.03;
      pointer-events:none;
      z-index:0;
    }
    .wrapper{
      position:relative;
      z-index:1;
      width:100%;
      max-width:1100px;
      background:radial-gradient(circle at top left,#e0f2fe 0,#ffffff 35%,#e5e7eb 130%);
      border-radius:28px;
      box-shadow:0 18px 40px rgba(15,23,42,.32);
      border:1px solid #1d4ed8;
      padding:16px;
    }
    header{
      display:grid;
      grid-template-columns:auto 1fr auto;
      gap:10px;
      align-items:center;
      border-bottom:1px solid #c7d2fe;
      padding-bottom:8px;
    }
    header img{max-height:58px;width:auto;}
    @media(max-width:900px){
      header{grid-template-columns:1fr;text-align:center;}
      .logos{align-items:center;}
      .author{text-align:center;}
    }
    .logos{
      display:flex;
      flex-direction:column;
      gap:6px;
      align-items:flex-start;
    }
    .title-main{
      font-size:1.2rem;
      margin:0;
      color:#111827;
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }
    .title-main span.icon{font-size:1.5rem;}
    .subtitle{
      margin:2px 0 0;
      font-size:.84rem;
      color:#4b5563;
    }
    .subtitle strong{color:#1d4ed8;}
    .tagline{
      display:inline-flex;
      align-items:center;
      gap:6px;
      margin-top:4px;
      padding:2px 8px;
      border-radius:999px;
      background:#e0f2fe;
      font-size:.78rem;
      color:#1d4ed8;
      font-weight:600;
    }
    .author{
      font-size:.8rem;
      color:#4b5563;
      text-align:right;
    }
    .author strong{display:block;color:#111827;font-size:.86rem;}

    main{
      display:grid;
      grid-template-columns:2fr 1fr;
      gap:12px;
      margin-top:12px;
    }
    @media(max-width:960px){
      main{grid-template-columns:1fr;}
    }

    .card{
      background:var(--card);
      border-radius:18px;
      border:1px solid var(--border);
      padding:10px 11px;
      margin-bottom:8px;
    }
    .card-title{
      font-weight:600;
      font-size:.9rem;
      margin-bottom:4px;
      color:#111827;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .card-title .icon{font-size:1.1rem;}
    .card-body{font-size:.86rem;color:var(--muted);}

    .student-row{
      display:flex;
      flex-direction:column;
      gap:3px;
      font-size:.82rem;
      margin-bottom:6px;
    }
    .student-row label{
      font-weight:600;
      color:#111827;
    }
    .student-row input{
      border-radius:999px;
      border:1px solid #cbd5f5;
      padding:4px 8px;
      font-size:.83rem;
    }

    .btn-row{
      margin-top:6px;
      display:flex;
      flex-wrap:wrap;
      gap:6px;
    }
    .btn{
      border-radius:999px;
      border:none;
      font-size:.8rem;
      padding:6px 10px;
      cursor:pointer;
      font-weight:600;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .btn-primary{background:#4f46e5;color:#eef2ff;}
    .btn-secondary{background:#e5e7eb;color:#111827;}
    .btn-outline{background:#fff;color:#4f46e5;border:1px solid #c7d2fe;}

    .status{
      margin-top:6px;
      font-size:.8rem;
      border-radius:10px;
      padding:6px 8px;
    }
    .status-info{background:#eef2ff;color:#4338ca;border:1px solid #c7d2fe;}
    .status-success{background:#dcfce7;color:#15803d;border:1px solid #86efac;}
    .status-error{background:#fee2e2;color:#b91c1c;border:1px solid #fecaca;}

    /* Sopa de letras */
    .ws-layout{
      display:grid;
      grid-template-columns:minmax(0,1.4fr) minmax(0,1fr);
      gap:10px;
    }
    @media(max-width:780px){
      .ws-layout{grid-template-columns:1fr;}
    }
    .ws-grid-wrapper{
      overflow-x:auto;
      padding-bottom:4px;
    }
    .ws-table{
      border-collapse:collapse;
      margin-top:4px;
      margin-inline:auto;
    }
    .ws-cell{
      width:28px;
      height:28px;
      border:1px solid #cbd5f5;
      text-align:center;
      vertical-align:middle;
      background:#ffffff;
      font-size:.9rem;
      font-weight:600;
      color:#111827;
      cursor:pointer;
      user-select:none;
      transition:background-color .2s ease, box-shadow .2s ease;
    }
    .ws-cell.selected{
      box-shadow:0 0 0 2px #38bdf8 inset;
    }
    .ws-cell.found{
      color:#020617;
    }

    .ws-wordlist h3{
      margin:4px 0;
      font-size:.86rem;
      color:#1f2937;
    }
    .ws-wordlist ul{
      list-style:none;
      padding-left:0;
      margin:2px 0 4px;
      font-size:.8rem;
      color:#4b5563;
    }
    .ws-wordlist li{
      margin-bottom:2px;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .ws-wordlist li span.badge{
      display:inline-flex;
      width:14px;
      height:14px;
      border-radius:999px;
      border:1px solid #cbd5f5;
      background:#f9fafb;
    }
    .ws-wordlist li.found{
      font-weight:600;
      color:#111827;
    }

    .ws-stats{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      font-size:.8rem;
      margin-top:4px;
    }
    .pill{
      border-radius:999px;
      padding:3px 8px;
      background:#e0f2fe;
      border:1px solid #bfdbfe;
      color:#1f2937;
    }
    .pill span.label{
      font-weight:600;
      color:#1d4ed8;
    }

    /* Paleta de colores */
    .palette{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:4px;
      font-size:.8rem;
      align-items:center;
    }
    .palette-label{
      color:#4b5563;
    }
    .color-btn{
      width:22px;
      height:22px;
      border-radius:999px;
      border:2px solid transparent;
      cursor:pointer;
    }
    .color-btn.active{
      border-color:#0f172a;
      box-shadow:0 0 0 1px #e5e7eb;
    }

    /* Avatar */
    .avatar-card{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:8px;
      text-align:center;
    }
    .avatar-circle{
      width:140px;
      height:140px;
      border-radius:50%;
      background:radial-gradient(circle at 30% 20%,#facc15,#eab308 35%,#0f172a 90%);
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      border:3px solid #fef3c7;
    }
    .avatar-circle img{
      width:100%;
      height:100%;
      object-fit:contain;
    }
    .avatar-text{
      font-size:.84rem;
      color:#111827;
    }
    .avatar-text strong{color:#4f46e5;}
    ul.steps{
      margin:4px 0 0;
      padding-left:18px;
      font-size:.8rem;
      color:#4b5563;
      text-align:left;
    }
    .steps li{margin-bottom:2px;}
    .badge-step{
      display:inline-flex;
      width:18px;
      height:18px;
      border-radius:999px;
      align-items:center;
      justify-content:center;
      background:#4f46e5;
      color:#fff;
      font-size:.72rem;
      margin-right:4px;
    }

    footer{
      margin-top:10px;
      padding-top:6px;
      border-top:1px solid #cbd5f5;
      font-size:.78rem;
      color:#6b7280;
      text-align:center;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <header>
      <div class="logos">
        <img src="sep_logo.png" alt="SEP">
        <img src="escudo_escuela.png" alt="Escuela">
      </div>
      <div>
        <h1 class="title-main"><span class="icon">üß©</span><span>Sopa de letras del Sistema Solar</span></h1>
        <p class="subtitle">
          Campo formativo: <strong>Saberes y Pensamiento Cient√≠fico ¬∑ Fase 5</strong><br>
          Contenido: <em>Sistema Solar y Universo: caracter√≠sticas de sus componentes y aportaciones cient√≠ficas y tecnol√≥gicas.</em>
        </p>
        <div class="tagline">5.¬∫ grado ¬∑ Identificaci√≥n de componentes del Sistema Solar</div>
      </div>
      <div class="author">
        <strong>Autor: Mtro. Mart√≠n Reta</strong>
        Escuela Primaria ‚ÄúGral. L√°zaro C√°rdenas‚Äù<br>
        Ejido Santa Mar√≠a, Pesquer√≠a, N.L.
      </div>
    </header>

    <main>
      <!-- Columna izquierda: sopa de letras -->
      <section>
        <div class="card">
          <div class="card-title"><span class="icon">üßë‚Äçüéì</span>Datos del alumno</div>
          <div class="card-body">
            <div class="student-row">
              <label for="studentName">Nombre del alumno(a):</label>
              <input type="text" id="studentName" placeholder="Escribe tu nombre aqu√≠">
            </div>
            <div class="student-row">
              <label for="group">Grado y grupo:</label>
              <input type="text" id="group" placeholder="Ej. 5¬∞ A">
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-title"><span class="icon">üéØ</span>Prop√≥sito de esta ODA</div>
          <div class="card-body">
            El alumno identifica y localiza en una <strong>sopa de letras interactiva</strong> los nombres de
            <strong>planetas y otros componentes del Sistema Solar</strong>, as√≠ como algunas de sus
            caracter√≠sticas (anillos, √≥rbita, sat√©lite, asteroides), reforzando la atenci√≥n, la memoria y el
            vocabulario cient√≠fico.
          </div>
        </div>

        <div class="card">
          <div class="card-title"><span class="icon">üîç</span>Sopa de letras ‚ÄúExploradores del Sistema Solar‚Äù</div>
          <div class="card-body">
            <p style="margin-top:0;margin-bottom:4px;">
              Busca las palabras de la lista. Haz clic en la primera y en la √∫ltima letra de cada palabra
              para subrayarla. Puedes elegir diferentes <strong>colores</strong> para cada palabra.
            </p>

            <div class="ws-layout">
              <!-- Grid -->
              <div class="ws-grid-wrapper">
                <table class="ws-table" aria-label="Sopa de letras del Sistema Solar">
                  <tbody id="gridBody"></tbody>
                </table>

                <div class="palette">
                  <span class="palette-label">Color del resaltador:</span>
                  <button class="color-btn active" data-color="#bbf7d0" title="Verde claro"></button>
                  <button class="color-btn" data-color="#bfdbfe" title="Azul claro"></button>
                  <button class="color-btn" data-color="#f9a8d4" title="Rosa"></button>
                  <button class="color-btn" data-color="#e9d5ff" title="Morado claro"></button>
                  <button class="color-btn" data-color="#fed7aa" title="Naranja claro"></button>
                </div>

                <div class="ws-stats">
                  <div class="pill"><span class="label">Palabras encontradas:</span> <span id="foundCount">0</span>/<span id="totalCount">0</span></div>
                  <div class="pill"><span class="label">Tiempo:</span> <span id="time">00:00</span></div>
                </div>
              </div>

              <!-- Lista de palabras -->
              <div class="ws-wordlist">
                <h3>Palabras por encontrar</h3>
                <ul id="wordList"></ul>
              </div>
            </div>

            <div class="btn-row">
              <button class="btn btn-primary" id="btnReset">üîÅ Reiniciar sopa de letras</button>
              <button class="btn btn-outline" id="btnPrintResults">üñ®Ô∏è Imprimir hoja de resultados</button>
            </div>

            <div id="ws-status" class="status status-info">
              üí° Selecciona las palabras haciendo clic en la <strong>primera</strong> y la <strong>√∫ltima</strong> letra.
              Si es correcta, se resaltar√° con el color elegido.
            </div>
          </div>
        </div>
      </section>

      <!-- Columna derecha: avatar, PDA, voz -->
      <aside>
        <div class="card">
          <div class="card-title"><span class="icon">üõ∞Ô∏è</span>Tu gu√≠a espacial</div>
          <div class="card-body">
            <div class="avatar-card">
              <div class="avatar-circle">
                <img src="avatar_guia.png" alt="Avatar gu√≠a">
              </div>
              <div class="avatar-text">
                <strong>Hola explorador del Sistema Solar,</strong> en esta sopa de letras deber√°s encontrar
                los nombres de varios planetas y otros componentes importantes. Usa diferentes colores para
                que tu trabajo quede <strong>bonito y organizado</strong>.
              </div>
              <ul class="steps">
                <li><span class="badge-step">1</span>Escribe tu nombre y grupo.</li>
                <li><span class="badge-step">2</span>Elige un color de resaltador.</li>
                <li><span class="badge-step">3</span>Haz clic en la primera y la √∫ltima letra de cada palabra.</li>
                <li><span class="badge-step">4</span>Cuando termines, revisa tu puntaje y, si se pide, imprime tus resultados.</li>
              </ul>
              <div class="btn-row">
                <button class="btn btn-secondary" id="btnListen">üîä Escuchar instrucciones</button>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-title"><span class="icon">üìå</span>PDA vinculado</div>
          <div class="card-body" style="font-size:.8rem;">
            Esta sopa de letras se relaciona con el <strong>PDA de 5.¬∫ grado</strong>:
            <em>‚ÄúIndaga, describe y representa con modelos las caracter√≠sticas de forma, ubicaci√≥n, color,
            tama√±o, distancia al Sol, temperatura, masa, n√∫mero de sat√©lites naturales y anillos, entre otras,
            de los componentes del Sistema Solar: Sol, planetas, sat√©lites y asteroides‚Äù.</em>
          </div>
        </div>
      </aside>
    </main>

    <footer>
      ODA ‚Äì Sopa de letras del Sistema Solar ¬∑ Saberes y Pensamiento Cient√≠fico ¬∑ Fase 5
    </footer>
  </div>

  <script>
    // Letras del tablero (15x15) ‚Äì ya incluye todas las palabras escondidas
    const GRID_LETTERS = [
      "SAMYETJUETRAMCK",
      "DEWEQXGANILLOSO",
      "NOPKRUVROBAQFFG",
      "OZBGWCUPCTNVBCK",
      "FNYHCVUUZZFEJRE",
      "DBUTIERRARLDGEQ",
      "FHZTOBWHIIUIHTB",
      "YOWPPMBVOOEOIIG",
      "WNYRUEEMLATRKPX",
      "GRQRKNNUTWIEBUG",
      "YUMGUNNIAPLTYJL",
      "GTVSSABTNUESRYF",
      "UASCKRLVHQTASTS",
      "RSKXOJFOURANOSP",
      "CLAZCKLVSTSUBAP"
    ];

    // Palabras y sus posiciones (fila, columna, direcci√≥n)
    // Coordenadas basadas en GRID_LETTERS
    const WORD_DATA = [
      { text: "ASTEROIDE", row: 12, col: 11, dr: -1, dc: 0, len: 9 },
      { text: "MERCURIO", row: 0, col: 2, dr: 1, dc: 1, len: 8 },
      { text: "SATELITE", row: 14, col: 10, dr: -1, dc: 0, len: 8 },
      { text: "JUPITER",  row: 10, col: 13, dr: -1, dc: 0, len: 7 },
      { text: "SATURNO",  row: 13, col: 1, dr: -1, dc: 0, len: 7 },
      { text: "NEPTUNO",  row: 9,  col: 6, dr: -1, dc: -1, len: 7 },
      { text: "ANILLOS",  row: 1,  col: 7, dr: 0,  dc: 1, len: 7 },
      { text: "TIERRA",   row: 5,  col: 3, dr: 0,  dc: 1, len: 6 },
      { text: "ORBITA",   row: 13, col: 4, dr: -1, dc: 1, len: 6 },
      { text: "VENUS",    row: 7,  col: 7, dr: 1,  dc: -1, len: 5 },
      { text: "MARTE",    row: 0,  col: 12, dr: 0,  dc: -1, len: 5 },
      { text: "URANO",    row: 13, col: 8, dr: 0,  dc: 1, len: 5 },
      { text: "LUNA",     row: 8,  col: 8, dr: 1,  dc: -1, len: 4 },
      { text: "SOL",      row: 14, col: 8, dr: -1, dc: -1, len: 3 }
    ];

    const gridBody = document.getElementById("gridBody");
    const wordList = document.getElementById("wordList");
    const foundCountSpan = document.getElementById("foundCount");
    const totalCountSpan = document.getElementById("totalCount");
    const timeSpan = document.getElementById("time");
    const statusDiv = document.getElementById("ws-status");

    let startCell = null;
    let currentColor = "#bbf7d0";
    let foundWords = new Set();
    let timerStarted = false;
    let startTime = null;
    let timerInterval = null;
    let lastResults = null;

    function buildGrid(){
      gridBody.innerHTML = "";
      GRID_LETTERS.forEach((rowStr,r)=>{
        const tr = document.createElement("tr");
        [...rowStr].forEach((ch,c)=>{
          const td = document.createElement("td");
          td.className = "ws-cell";
          td.textContent = ch;
          td.dataset.row = r;
          td.dataset.col = c;
          td.addEventListener("click", ()=> handleCellClick(td));
          tr.appendChild(td);
        });
        gridBody.appendChild(tr);
      });
    }

    function buildWordList(){
      wordList.innerHTML = "";
      WORD_DATA.forEach(w=>{
        const li = document.createElement("li");
        li.dataset.word = w.text;
        li.innerHTML = `<span class="badge"></span>${w.text}`;
        wordList.appendChild(li);
      });
      totalCountSpan.textContent = WORD_DATA.length;
    }

    function sign(x){ return x>0?1:x<0?-1:0; }

    function handleCellClick(cell){
      if(!timerStarted){
        startTimer();
        timerStarted = true;
      }

      if(!startCell){
        startCell = cell;
        cell.classList.add("selected");
      }else{
        const endCell = cell;
        startCell.classList.remove("selected");
        if(startCell === endCell){
          startCell = null;
          return;
        }
        evaluateSelection(startCell, endCell);
        startCell = null;
      }
    }

    function cellsBetween(r0,c0,r1,c1){
      const dr = sign(r1-r0);
      const dc = sign(c1-c0);
      if(dr===0 && dc===0) return [];
      const length = Math.max(Math.abs(r1-r0), Math.abs(c1-c0)) + 1;
      const cells = [];
      for(let i=0;i<length;i++){
        cells.push({r:r0+dr*i,c:c0+dc*i});
      }
      return {cells, dr, dc, length};
    }

    function findWordMatch(selection){
      const {cells, dr, dc, length} = selection;
      if(cells.length===0) return null;

      const r0 = cells[0].r;
      const c0 = cells[0].c;

      for(const w of WORD_DATA){
        if(foundWords.has(w.text)) continue;
        if(length !== w.len) continue;

        // Direcci√≥n normal
        if(r0 === w.row && c0 === w.col && dr === w.dr && dc === w.dc){
          return w;
        }
        // Direcci√≥n invertida
        const endRow = w.row + w.dr*(w.len-1);
        const endCol = w.col + w.dc*(w.len-1);
        if(r0 === endRow && c0 === endCol && dr === -w.dr && dc === -w.dc){
          return w;
        }
      }
      return null;
    }

    function evaluateSelection(startCell, endCell){
      const r0 = parseInt(startCell.dataset.row,10);
      const c0 = parseInt(startCell.dataset.col,10);
      const r1 = parseInt(endCell.dataset.row,10);
      const c1 = parseInt(endCell.dataset.col,10);

      const selection = cellsBetween(r0,c0,r1,c1);
      const match = findWordMatch(selection);

      if(match){
        highlightWord(selection.cells, match.text);
        statusDiv.className = "status status-success";
        statusDiv.innerHTML = `‚úÖ Palabra correcta: <strong>${match.text}</strong>. ¬°Sigue buscando!`;
      }else{
        // Marcar error breve
        statusDiv.className = "status status-error";
        statusDiv.innerHTML = "‚ùå Esa selecci√≥n no corresponde a ninguna palabra. Intenta de nuevo.";
        setTimeout(()=>{
          statusDiv.className = "status status-info";
          statusDiv.innerHTML = "üí° Selecciona las palabras haciendo clic en la primera y la √∫ltima letra. Si es correcta, se resaltar√° con el color elegido.";
        }, 1600);
      }
    }

    function highlightWord(cells, wordText){
      foundWords.add(wordText);
      // Resaltar celdas
      cells.forEach(pos=>{
        const selector = `.ws-cell[data-row='${pos.r}'][data-col='${pos.c}']`;
        const cell = document.querySelector(selector);
        if(cell){
          cell.style.backgroundColor = currentColor;
          cell.classList.add("found");
        }
      });
      // Marcar en lista
      const li = wordList.querySelector(`li[data-word='${wordText}']`);
      if(li){
        li.classList.add("found");
        const badge = li.querySelector(".badge");
        if(badge){ badge.style.backgroundColor = currentColor; }
      }
      foundCountSpan.textContent = foundWords.size;

      if(foundWords.size === WORD_DATA.length){
        stopTimer();
        statusDiv.className = "status status-success";
        statusDiv.innerHTML = "üéâ ¬°Felicidades! Has encontrado todas las palabras de la sopa de letras.";
        lastResults = {
          found: foundWords.size,
          total: WORD_DATA.length,
          seconds: getElapsedSeconds(),
          finishedAt: new Date().toLocaleString("es-MX")
        };
      }
    }

    // Temporizador
    function startTimer(){
      startTime = Date.now();
      timerInterval = setInterval(updateTime, 1000);
    }
    function stopTimer(){
      if(timerInterval){
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }
    function getElapsedSeconds(){
      if(!startTime) return 0;
      return Math.floor((Date.now()-startTime)/1000);
    }
    function updateTime(){
      const s = getElapsedSeconds();
      const mins = String(Math.floor(s/60)).padStart(2,"0");
      const secs = String(s%60).padStart(2,"0");
      timeSpan.textContent = `${mins}:${secs}`;
    }

    function resetGame(){
      stopTimer();
      timerStarted = false;
      startTime = null;
      timeSpan.textContent = "00:00";
      foundWords.clear();
      lastResults = null;
      document.querySelectorAll(".ws-cell").forEach(cell=>{
        cell.style.backgroundColor = "#ffffff";
        cell.classList.remove("found","selected");
      });
      document.querySelectorAll("#wordList li").forEach(li=>{
        li.classList.remove("found");
        const badge = li.querySelector(".badge");
        if(badge) badge.style.backgroundColor = "";
      });
      foundCountSpan.textContent = "0";
      statusDiv.className = "status status-info";
      statusDiv.innerHTML = "üí° Selecciona las palabras haciendo clic en la primera y la √∫ltima letra. Si es correcta, se resaltar√° con el color elegido.";
    }

    // Imprimir resultados
    function printResults(){
      if(!lastResults){
        alert("Primero completa la sopa de letras para poder imprimir la hoja de resultados.");
        return;
      }
      const studentName = (document.getElementById("studentName").value || "___________________").trim() || "___________________";
      const group = (document.getElementById("group").value || "________").trim() || "________";

      const mins = String(Math.floor(lastResults.seconds/60)).padStart(2,"0");
      const secs = String(lastResults.seconds%60).padStart(2,"0");

      const win = window.open("","_blank");
      win.document.write(`<!DOCTYPE html>
      <html lang="es">
      <head>
        <meta charset="UTF-8">
        <title>Hoja de resultados ‚Äì Sopa de letras del Sistema Solar</title>
        <style>
          body{font-family:system-ui,-apple-system,"Segoe UI",sans-serif;padding:20px;color:#111827;}
          h1{font-size:1.2rem;margin:0 0 6px;}
          h2{font-size:1rem;margin:10px 0 4px;}
          table{border-collapse:collapse;width:100%;margin-top:8px;font-size:.9rem;}
          th,td{border:1px solid #d1d5db;padding:6px 8px;text-align:left;}
          th{background:#e5e7eb;}
          .box{border:1px solid #d1d5db;border-radius:6px;min-height:70px;margin-top:4px;}
          .small{font-size:.82rem;color:#4b5563;}
          ul{margin-top:4px;}
        </style>
      </head>
      <body>
        <h1>Hoja de resultados ‚Äì Sopa de letras del Sistema Solar</h1>
        <p><strong>Alumno(a):</strong> ${studentName} &nbsp;&nbsp; <strong>Grado y grupo:</strong> ${group}</p>
        <p class="small"><strong>Fecha:</strong> ${lastResults.finishedAt}</p>

        <h2>Procesos de desarrollo de aprendizaje (PDA)</h2>
        <p class="small">
          Indaga, describe y representa con modelos las caracter√≠sticas de los componentes del Sistema Solar:
          Sol, planetas, sat√©lites y asteroides.
        </p>

        <h2>Resultados de la actividad</h2>
        <table>
          <tr><th>Indicador</th><th>Valor</th></tr>
          <tr><td>Palabras totales</td><td>${lastResults.total}</td></tr>
          <tr><td>Palabras encontradas</td><td>${lastResults.found}</td></tr>
          <tr><td>Tiempo empleado</td><td>${mins}:${secs} minutos</td></tr>
        </table>

        <h2>Palabras utilizadas</h2>
        <ul>
          ${WORD_DATA.map(w=>`<li>${w.text}</li>`).join("")}
        </ul>

        <h2>Observaciones del docente</h2>
        <div class="box"></div>

        <h2>Compromisos de mejora del alumno(a)</h2>
        <div class="box"></div>

        <p style="margin-top:18px;font-size:.86rem;">
          Firma del alumno(a): _____________________________ &nbsp;&nbsp;
          Firma del docente: _____________________________
        </p>
      </body>
      </html>`);
      win.document.close();
      win.print();
    }

    // Paleta de colores
    document.querySelectorAll(".color-btn").forEach(btn=>{
      btn.style.backgroundColor = btn.dataset.color;
      btn.addEventListener("click", ()=>{
        document.querySelectorAll(".color-btn").forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
        currentColor = btn.dataset.color;
      });
    });

    // Voz con instrucciones
    document.getElementById("btnListen").addEventListener("click", ()=>{
      const text = "Hola explorador. En esta sopa de letras buscar√°s palabras relacionadas con el Sistema Solar, como planetas, sat√©lites y asteroides. Elige un color de resaltador y haz clic primero en la primera letra de la palabra y despu√©s en la √∫ltima. Si la encuentras, se pintar√° con ese color. Intenta encontrar todas las palabras en el menor tiempo posible.";
      if(!('speechSynthesis' in window)){
        alert("Tu navegador no soporta la lectura de voz. Puedes leer las instrucciones en la pantalla.");
        return;
      }
      const synth = window.speechSynthesis;
      synth.cancel();
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = "es-MX";
      const voices = synth.getVoices().filter(v=>v.lang && v.lang.startsWith("es"));
      if(voices.length>0) utter.voice = voices[0];
      synth.speak(utter);
    });

    // Botones principales
    document.getElementById("btnReset").addEventListener("click", resetGame);
    document.getElementById("btnPrintResults").addEventListener("click", printResults);

    // Inicializar todo
    buildGrid();
    buildWordList();
    resetGame();
  </script>
</body>
</html>
